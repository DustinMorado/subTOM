

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>subtom_extract_subtomograms &mdash; subTOM 1.0.3 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="subtom_maskcorrected_fsc" href="subtom_maskcorrected_fsc.html" />
    <link rel="prev" title="subtom_extract_noise" href="subtom_extract_noise.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> subTOM
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../conventions.html">Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial.html">Tutorial</a></li>
</ul>
<p class="caption"><span class="caption-text">Links to Individual Script Documentation:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="subtom_alignment.html">subtom_alignment.sh</a></li>
<li class="toctree-l1"><a class="reference internal" href="subtom_average.html">subtom_average.sh</a></li>
<li class="toctree-l1"><a class="reference internal" href="subtom_cat_motls.html">subtom_cat_motls.sh</a></li>
<li class="toctree-l1"><a class="reference internal" href="subtom_clean_motl.html">subtom_clean_motl.sh</a></li>
<li class="toctree-l1"><a class="reference internal" href="subtom_compare_motls.html">subtom_compare_motls.sh</a></li>
<li class="toctree-l1"><a class="reference internal" href="subtom_even_odd_motl.html">subtom_even_odd_motl.sh</a></li>
<li class="toctree-l1"><a class="reference internal" href="subtom_extract_noise.html">subtom_extract_noise.sh</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">subtom_extract_subtomograms.sh</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#options">Options</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#directories">Directories</a></li>
<li class="toctree-l3"><a class="reference internal" href="#variables">Variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="#memory-options">Memory Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#other-cluster-options">Other Cluster Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#subtomogram-extraction-workflow-options">Subtomogram Extraction Workflow Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#file-options">File Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tomogram-options">Tomogram Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#extraction-options">Extraction Options</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="subtom_maskcorrected_fsc.html">subtom_maskcorrected_fsc.sh</a></li>
<li class="toctree-l1"><a class="reference internal" href="subtom_preprocess.html">subtom_preprocess.sh</a></li>
<li class="toctree-l1"><a class="reference internal" href="subtom_plot_filter.html">subtom_plot_filter.sh</a></li>
<li class="toctree-l1"><a class="reference internal" href="subtom_plot_scanned_angles.html">subtom_plot_scanned_angles.sh</a></li>
<li class="toctree-l1"><a class="reference internal" href="subtom_reconstruct.html">subtom_reconstruct.sh</a></li>
<li class="toctree-l1"><a class="reference internal" href="subtom_scale_motl.html">subtom_scale_motl.sh</a></li>
<li class="toctree-l1"><a class="reference internal" href="subtom_seed_positions.html">subtom_seed_positions.sh</a></li>
<li class="toctree-l1"><a class="reference internal" href="subtom_shape.html">subtom_shape.sh</a></li>
<li class="toctree-l1"><a class="reference internal" href="subtom_split_motl_by_row.html">subtom_split_motl_by_row.sh</a></li>
<li class="toctree-l1"><a class="reference internal" href="subtom_transform_motl.html">subtom_transform_motl.sh</a></li>
</ul>
<p class="caption"><span class="caption-text">Links to Individual Function Documentation:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../functions/introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functions/subtom_cat_motls.html">subtom_cat_motls.m</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functions/subtom_clean_motl.html">subtom_clean_motl.m</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functions/subtom_compare_motls.html">subtom_compare_motls.m</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functions/subtom_even_odd_motl.html">subtom_even_odd_motl.m</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functions/subtom_extract_noise.html">subtom_extract_noise.m</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functions/subtom_extract_subtomograms.html">subtom_extract_subtomograms.m</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functions/subtom_maskcorrected_fsc.html">subtom_maskcorrected_fsc.m</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functions/subtom_parallel_sums.html">subtom_parallel_sums.m</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functions/subtom_plot_filter.html">subtom_plot_filter.m</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functions/subtom_plot_scanned_angles.html">subtom_plot_scanned_angles.m</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functions/subtom_scale_motl.html">subtom_scale_motl.m</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functions/subtom_scan_angles_exact.html">subtom_scan_angles_exact.m</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functions/subtom_seed_positions.html">subtom_seed_positions.m</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functions/subtom_shape.html">subtom_shape.m</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functions/subtom_split_motl_by_row.html">subtom_split_motl_by_row.m</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functions/subtom_transform_motl.html">subtom_transform_motl.m</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functions/subtom_weighted_average.html">subtom_weighted_average.m</a></li>
</ul>
<p class="caption"><span class="caption-text">Classification Documentation:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../classification/multireference/index.html">Multireference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../classification/pca/index.html">PCA</a></li>
</ul>
<p class="caption"><span class="caption-text">Analysis Documentation:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../analysis/b_factor_by_subsets/index.html">B-Factor from Subsets</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">subTOM</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>subtom_extract_subtomograms</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/scripts/subtom_extract_subtomograms.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="subtom-extract-subtomograms">
<h1>subtom_extract_subtomograms<a class="headerlink" href="#subtom-extract-subtomograms" title="Permalink to this headline">¶</a></h1>
<p>This script takes an input number of cores, and on each core extract one
tomogram at a time as written in a specified row of the all motive list.
Parallelization works by writing a start file upon openinig of a tomo, and a
completion file.  After tomogram extraction, it moves on to the next tomogram
that hasn’t been started.</p>
<p>This tomogram extraction script uses one MATLAB compiled scripts below:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../functions/subtom_extract_subtomograms.html"><span class="doc">subtom_extract_subtomograms</span></a></p></li>
</ul>
<div class="section" id="options">
<h2>Options<a class="headerlink" href="#options" title="Permalink to this headline">¶</a></h2>
<div class="section" id="directories">
<h3>Directories<a class="headerlink" href="#directories" title="Permalink to this headline">¶</a></h3>
<dl class="simple">
<dt>tomogram_dir</dt><dd><p>Absolute path to the folder where the tomograms are stored</p>
</dd>
<dt>scratch_dir</dt><dd><p>Absolute path to the folder with the input to be processed.
Other paths are relative to this one.</p>
</dd>
<dt>mcr_cache_dir</dt><dd><p>Absolute path to MCR directory for the processing.</p>
</dd>
<dt>exec_dir</dt><dd><p>Directory for executables</p>
</dd>
</dl>
</div>
<div class="section" id="variables">
<h3>Variables<a class="headerlink" href="#variables" title="Permalink to this headline">¶</a></h3>
<dl class="simple">
<dt>extract_exe</dt><dd><p>Subtomogram extraction executable</p>
</dd>
<dt>motl_dump_exe</dt><dd><p>MOTL dump executable</p>
</dd>
</dl>
</div>
<div class="section" id="memory-options">
<h3>Memory Options<a class="headerlink" href="#memory-options" title="Permalink to this headline">¶</a></h3>
<dl class="simple">
<dt>mem_free</dt><dd><p>The amount of memory the job requires for alignment. This variable determines
whether a number of CPUs will be requested to be dedicated for each job. At
24G, one half of the CPUs on a node will be dedicated for each of the
processes (12 CPUs). At 48G, all of the CPUs on the node will be dedicated for
each of the processes (24 CPUs).</p>
</dd>
<dt>mem_max</dt><dd><p>The upper bound on the amount of memory the alignment job is allowed to use.
If any of the processes request or require more memory than this, the queue
will kill the process. This is more of an option for safety of the cluster to
prevent the user from crashing the cluster requesting too much memory.</p>
</dd>
</dl>
</div>
<div class="section" id="other-cluster-options">
<h3>Other Cluster Options<a class="headerlink" href="#other-cluster-options" title="Permalink to this headline">¶</a></h3>
<dl class="simple">
<dt>job_name</dt><dd><p>The job name prefix that will be used for the cluster submission scripts, log
files, and error logs for the processing. Be careful that this name is unique
because previous submission scripts, logs, and error logs with the same job
name prefix will be overwritten in the case of a name collision.</p>
</dd>
<dt>run_local</dt><dd><p>If the user wants to skip the cluster and run the job locally, this value
should be set to 1.</p>
</dd>
</dl>
</div>
<div class="section" id="subtomogram-extraction-workflow-options">
<h3>Subtomogram Extraction Workflow Options<a class="headerlink" href="#subtomogram-extraction-workflow-options" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="file-options">
<h3>File Options<a class="headerlink" href="#file-options" title="Permalink to this headline">¶</a></h3>
<dl>
<dt>iteration</dt><dd><p>The iteration of the all particle motive list to extract from : input will be
all_motl_fn_prefix_iteration.em (define as integer)</p>
</dd>
<dt>all_motl_fn_prefix</dt><dd><p>Relative path to allmotl file from root folder.</p>
</dd>
<dt>subtomo_fn_prefix</dt><dd><p>Relative path and filename for output subtomograms.</p>
</dd>
<dt>stats_fn_prefix</dt><dd><p>Relative path and filename for stats .csv files.</p>
<p>The CSV format of the subtomogram stats is a single file for each tomogram
with one line per particle in the tomogram with six columns. The particle
columns are as follows:</p>
</dd>
</dl>
<table class="docutils align-default">
<colgroup>
<col style="width: 35%" />
<col style="width: 65%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Column</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>Particle Index (Motive List row 4)</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>Mean value for the subtomogram</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>Maximum value in the subtomogram</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>Minimum value in the subtomogram</p></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><p>Standard deviation of values in the subtomogram</p></td>
</tr>
<tr class="row-odd"><td><p>6</p></td>
<td><p>Variance of values in the subtomogram</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="tomogram-options">
<h3>Tomogram Options<a class="headerlink" href="#tomogram-options" title="Permalink to this headline">¶</a></h3>
<dl class="simple">
<dt>tomo_row</dt><dd><p>Which row in the motl file contains the correct tomogram number.
Usually row 5 and 7 both correspond to the correct value and can be used
interchangeably, but there are instances when 5 contains a sequential ordered
value starting from 1, while 7 contains the correct corresponding tomogram.</p>
</dd>
</dl>
</div>
<div class="section" id="extraction-options">
<h3>Extraction Options<a class="headerlink" href="#extraction-options" title="Permalink to this headline">¶</a></h3>
<dl class="simple">
<dt>box_size</dt><dd><p>Size of subtomogram in pixels</p>
</dd>
<dt>subtomo_digits</dt><dd><p>Leading zeros for subtomograms, for AV3, use 1. Other numbers are useful for
DYNAMO.</p>
</dd>
<dt>reextract</dt><dd><p>Set reextract to 1 if you want to force the program to re-extract subtomograms
even if the stats file and the subtomograms already exist. If the stats file
for the tomogram exists and is the correct size the whole tomogram will be
skipped. If the subtomogram exists it will also be skipped, unless this option
is true.</p>
</dd>
<dt>preload_tomogram</dt><dd><p>Set preload_tomogram to 1 if you want to read the whole tomogram into memory
before extraction. This is the fastest way to extract particles however the
system needs to be able to have the memory to fit the whole tomogram into
memory or otherwise it will crash. If it is set to 0, then either the
subtomograms can be extracted using a memory-map to the data, or read directly
from the file.</p>
</dd>
<dt>use_tom_red</dt><dd><p>Set use_tom_red to 1 if you want to use the AV3/TOM function tom_red to
extract particles. This requires that preload_tomogram above is set to 1. This
is the original way to extract particles, but it seemed to sometimes produce
subtomograms that were incorrectly sized. If it is set to 0 then an inlined
window function is used instead.</p>
</dd>
<dt>use_memmap</dt><dd><p>Set use_memmap to 1 to memory-map the tomogram and read subtomograms from this
map. This appears to be a little slower than having the tomogram fully in
memory without the massive memory footprint. However, it also appears to be
slightly unstable and may crash unexpectedly. If it is set to 0 and
preload_tomogram is also 0, then subtomograms will be read directly from the
tomogram on disk. This also requires much less memory, however it appears to
be extremely slow, so this only makes sense for a large number of tomograms
being extracted on the cluster.</p>
</dd>
</dl>
</div>
</div>
<div class="section" id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">tomogram_dir</span><span class="o">=</span><span class="s2">&quot;/net/dstore2/teraraid/dmorado/subTOM_tutorial/data/tomos/bin8&quot;</span>

<span class="nv">scratch_dir</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">PWD</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="nv">mcr_cache_dir</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">scratch_dir</span><span class="si">}</span><span class="s2">/mcr&quot;</span>

<span class="nv">exec_dir</span><span class="o">=</span><span class="s2">&quot;/net/dstore2/teraraid/dmorado/software/subTOM/bin&quot;</span>

<span class="nv">extract_exe</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">exec_dir</span><span class="si">}</span><span class="s2">/alignment/subtom_extract_subtomograms&quot;</span>

<span class="nv">motl_dump_exe</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">exec_dir</span><span class="si">}</span><span class="s2">/MOTL/motl_dump&quot;</span>

<span class="nv">mem_free</span><span class="o">=</span><span class="s2">&quot;1G&quot;</span>

<span class="nv">mem_max</span><span class="o">=</span><span class="s2">&quot;64G&quot;</span>

<span class="nv">job_name</span><span class="o">=</span><span class="s2">&quot;subTOM&quot;</span>

<span class="nv">run_local</span><span class="o">=</span><span class="m">0</span>

<span class="nv">iteration</span><span class="o">=</span><span class="m">1</span>

<span class="nv">all_motl_fn_prefix</span><span class="o">=</span><span class="s2">&quot;combinedmotl/allmotl&quot;</span>

<span class="nv">subtomo_fn_prefix</span><span class="o">=</span><span class="s2">&quot;subtomograms/subtomo&quot;</span>

<span class="nv">stats_fn_prefix</span><span class="o">=</span><span class="s2">&quot;subtomograms/stats/tomo&quot;</span>

<span class="nv">tomo_row</span><span class="o">=</span><span class="m">7</span>

<span class="nv">box_size</span><span class="o">=</span><span class="m">128</span>

<span class="nv">subtomo_digits</span><span class="o">=</span><span class="m">1</span>

<span class="nv">reextract</span><span class="o">=</span><span class="m">0</span>

<span class="nv">preload_tomogram</span><span class="o">=</span><span class="m">1</span>

<span class="nv">use_tom_red</span><span class="o">=</span><span class="m">0</span>

<span class="nv">use_memmap</span><span class="o">=</span><span class="m">0</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="subtom_maskcorrected_fsc.html" class="btn btn-neutral float-right" title="subtom_maskcorrected_fsc" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="subtom_extract_noise.html" class="btn btn-neutral float-left" title="subtom_extract_noise" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Dustin Reed Morado

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>